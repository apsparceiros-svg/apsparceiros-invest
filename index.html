<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>APSPARCEIROS Invest — Dashboard Premium</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg:#070707;
  --panel:#0f0f0f;
  --muted:#9e9e9e;
  --gold:#c9a84b;
  --card:#121212;
  --accent:#e6e6e6;
}
*{box-sizing:border-box;font-family:Inter,system-ui,Arial;color:var(--accent)}
html,body{height:100%;margin:0;background:linear-gradient(180deg,#040404,#0a0a0a);-webkit-font-smoothing:antialiased}
.header{display:flex;justify-content:space-between;align-items:center;padding:18px 24px;border-bottom:1px solid rgba(255,255,255,0.04)}
.brand{font-weight:800;color:var(--gold);letter-spacing:0.6px}
.header .meta{color:var(--muted);font-size:13px}
.container{display:flex;height:calc(100vh - 72px);gap:18px;padding:18px}
.sidebar{width:340px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:14px;overflow:auto}
.content{flex:1;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));border-radius:12px;padding:14px;overflow:auto}
.section-title{font-weight:700;color:var(--gold);margin-bottom:8px}
.project-card{background:var(--card);padding:12px;border-radius:10px;margin-bottom:12px;display:flex;gap:12px;align-items:flex-start;border:1px solid rgba(255,255,255,0.03);cursor:pointer;flex-direction:column}
.project-card .info{flex:1;width:100%}
.small{font-size:12px;color:var(--muted)}
.kpi{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
.kpi .item{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));padding:8px;border-radius:8px;min-width:90px;text-align:center}
.kpi .value{font-weight:700;color:var(--gold);margin-top:6px}
.controls label{display:block;font-size:12px;color:var(--muted);margin-top:8px}
.controls input[type=text],
.controls input[type=number],
.project-card input[type=text],
.project-card input[type=number]{
    background-color: #1e1e1e;
    color: #fff;
    border: 1px solid #c9a84b;
    padding: 6px 8px;
    border-radius: 6px;
    width: 100%;
    margin-bottom:6px;
}
.project-card input[type=text]:focus,
.project-card input[type=number]:focus{
    outline:2px solid #c9a84b;
    background-color:#292929;
}
.button{background:var(--gold);color:#0b0b0b;border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700}
.button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--accent)}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));padding:12px;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.02)}
.tooltip{position:relative;display:inline-block}
.tooltip .tt{visibility:hidden;width:260px;background:#0c0c0c;color:var(--muted);text-align:left;border-radius:6px;padding:10px;position:absolute;z-index:10;bottom:130%;left:50%;transform:translateX(-50%);opacity:0;transition:opacity .12s}
.tooltip:hover .tt{visibility:visible;opacity:1}
.modal-content{background:#0b0b0b;border-radius:12px;padding:18px;width:90%;max-width:1000px;max-height:90%;overflow:auto;position:relative;display:flex;flex-direction:column;gap:12px}
#projectModal{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:50}
.modal-close{position:absolute;top:10px;right:14px;font-size:24px;cursor:pointer;color:var(--muted)}
.tabs{display:flex;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.tab{padding:6px 12px;border-radius:6px;background:rgba(255,255,255,0.02);cursor:pointer}
.tab.active{background:var(--gold);color:#0b0b0b;font-weight:700}
.tab-content{margin-top:12px}
.tab-total{margin-top:6px;font-weight:700;color:var(--gold)}
@media(max-width:980px){.container{flex-direction:column}.sidebar{width:auto}}
</style>
</head>
<body>

<header class="header">
  <div class="brand">APSPARCEIROS Invest</div>
  <div class="meta">Dashboard · Portfólio · Proteção</div>
</header>

<!-- Login Modal -->
<div id="loginModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:50">
  <div style="background:#0b0b0b;padding:22px;border-radius:10px;width:420px;border:1px solid rgba(255,255,255,0.04)">
    <h3 style="margin-top:0;color:var(--gold)">Acesso ao Painel</h3>
    <p class="small" style="margin-bottom:12px">Insira a senha para editar os valores</p>
    <input id="pwd" type="password" placeholder="Senha" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--accent)">
    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
      <button id="btnLogin" class="button">Entrar</button>
    </div>
    <p class="small" style="margin-top:10px;color:var(--muted)">Senha: <strong>Investidor</strong></p>
  </div>
</div>

<div class="container" id="app" style="display:none">
  <aside class="sidebar">
    <div class="section-title">Portfólio</div>
    <div id="projectsList"></div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Filtrar</strong><div class="small">por indicador</div></div>
        <div><button id="btnNew" class="button">+ Novo</button></div>
      </div>
      <div class="controls" style="margin-top:10px">
        <label>Busca</label><input id="search" type="text" placeholder="Pesquisar projeto...">
        <label class="small">Mostrar</label>
        <select id="showIndicators"><option value="all">Todos</option><option value="vgv">VGV</option><option value="irr">TIR</option></select>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:10px 0">

        <div><strong>Condições de Venda</strong></div>
        <label>Desconto Pré-lançamento (%)</label>
        <input id="discountPre" type="number" min="0" max="100" step="0.1" value="10">
        <label>Desconto Lançamento (%)</label>
        <input id="discountLaunch" type="number" min="0" max="100" step="0.1" value="5">

        <label>Entrada (%)</label>
        <input id="entradaPct" type="number" min="0" max="100" step="0.1" value="30">

        <label>Parcelas da entrada (nº)</label>
        <input id="entradaMonths" type="number" min="1" step="1" value="6">

        <label>Parcelas do saldo (nº)</label>
        <input id="parcelasRestantes" type="number" min="1" step="1" value="24">

        <div class="small" style="margin-top:6px">A entrada é paga em X parcelas a partir do mês da venda; o restante (saldo) é pago em Y parcelas subsequentes.</div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="btnExport" class="button">Exportar JSON</button>
          <button id="btnReset" class="button ghost">Restaurar</button>
        </div>
      </div>
    </div>
    <div class="footer small">APSPARCEIROS Invest · Template editável</div>
  </aside>

  <main class="content">
    <div style="display:flex;gap:12px;align-items:center">
      <div style="flex:1">
        <h2 id="panelTitle">Dashboard</h2>
        <div class="small">Edite os projetos e clique em salvar</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="tooltip"><button id="btnHelp" class="button ghost">Legenda</button><div class="tt"><strong>ROI</strong>: retorno sobre o capital investido.<br><strong>TIR</strong>: taxa interna de retorno anualizada.<br><strong>Payback</strong>: meses para recuperar o aporte.</div></div>
        <button id="btnDownloadCsv" class="button ghost">Download CSV</button>
        <button id="btnPublish" class="button">Salvar alterações</button>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:12px">
      <section>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>Visão Geral do Portfólio</strong><div class="small">Resumo consolidado</div></div>
            <div style="text-align:right">
              <div class="small">VGV total</div>
              <div style="font-weight:800;color:var(--gold)" id="totalVgv">R$ 0</div>
            </div>
          </div>
          <div style="display:flex;gap:12px;margin-top:12px">
            <div style="flex:1"><canvas id="chartPortfolio" height="120"></canvas></div>
          </div>
        </div>
      </section>
      <aside>
        <div class="card">
          <strong>Indicadores</strong>
          <div class="kpi" id="portfolioKpi"></div>
        </div>
      </aside>
    </div>

  </main>
</div>

<!-- Modal Projetos -->
<div id="projectModal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">&times;</span>
    <div id="modalHeader" style="display:flex;gap:16px;flex-wrap:wrap;margin-bottom:12px"></div>
    <div id="modalBody"></div>
  </div>
</div>

<script>
let projects = [];
let charts = {};
let logged = false;

document.getElementById('btnLogin').onclick = ()=>{
  const pwd = document.getElementById('pwd').value;
  if(pwd==='Investidor'){logged=true;document.getElementById('loginModal').style.display='none';document.getElementById('app').style.display='flex';initApp()}
  else alert('Senha incorreta')
};

function initApp(){
  // Carregar projeto exemplo
  projects = [{
    id:1,name:'Projeto A',VGV:500000,roi:12,irrAnnual:0.11,npvVal:420000,payback:24,
    receiptsPre:[50000,60000],receiptsLaunch:[80000,90000],receiptsMonthly:[30000,32000,34000],
    costs:[10000,12000,14000],investments:[150000,50000],net:[80000,90000,95000]
  },{
    id:2,name:'Projeto B',VGV:750000,roi:18,irrAnnual:0.16,npvVal:680000,payback:18,
    receiptsPre:[60000,65000],receiptsLaunch:[90000,95000],receiptsMonthly:[40000,42000,45000],
    costs:[15000,16000,17000],investments:[200000,60000],net:[100000,110000,115000]
  }];
  renderProjects();
  renderPortfolio();
}

function renderProjects(){
  const list = document.getElementById('projectsList'); list.innerHTML='';
  projects.forEach(p=>{
    const card = document.createElement('div'); card.className='project-card';
    card.innerHTML=`<div class="info"><strong>${p.name}</strong></div>`;
    card.onclick=()=>openModalProject(p);
    list.appendChild(card);
  });
}

function renderPortfolio(){
  const totalVgv = projects.reduce((a,b)=>a+b.VGV,0);
  document.getElementById('totalVgv').innerText='R$ '+totalVgv.toLocaleString('pt-BR');

  // Gráfico portfólio simples
  const ctx=document.getElementById('chartPortfolio').getContext('2d');
  if(charts.portfolio) charts.portfolio.destroy();
  charts.portfolio = new Chart(ctx,{
    type:'bar',
    data:{
      labels:projects.map(p=>p.name),
      datasets:[{label:'VGV',data:projects.map(p=>p.VGV),backgroundColor:'#c9a84b'}]
    },
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{ticks:{color:'#fff'}},x:{ticks:{color:'#fff'}}}}
  });
}

// ===== Modal =====
function openModalProject(d){
  const modal=document.getElementById('projectModal'); modal.style.display='flex';
  const header=document.getElementById('modalHeader'); header.innerHTML='';
  const body=document.getElementById('modalBody'); body.innerHTML='';

  const kpis=[
    {label:'VGV',value:d.VGV},
    {label:'ROI',value:d.roi+'%'},
    {label:'TIR',value:(d.irrAnnual*100).toFixed(1)+'%'},
    {label:'VPL',value:d.npvVal.toLocaleString('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0})},
    {label:'Payback',value:d.payback+' meses'}
  ];
  kpis.forEach(k=>{
    const div=document.createElement('div'); div.className='item'; div.style.minWidth='120px';
    div.innerHTML=`<div class="small">${k.label}</div><div class="value">${typeof k.value==='number'?k.value.toLocaleString('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0}):k.value}</div>`;
    header.appendChild(div);
  });

  // Tabs
  const tabs=document.createElement('div'); tabs.className='tabs';
  ['Receitas','Custos','Fluxo Líquido'].forEach((name,i)=>{
    const tab=document.createElement('div'); tab.className='tab'+(i===0?' active':''); tab.innerText=name;
    tab.onclick=()=>{
      body.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');
      body.querySelectorAll('.tab-content')[i].style.display='block';
      tabs.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
    };
    tabs.appendChild(tab);
  });
  body.appendChild(tabs);

  const labels=Array.from({length:d.net.length},(_,i)=>'M'+(i+1));
  const datasets=[
    {label:'Pré-lançamento',data:d.receiptsPre,borderColor:'#ff9800',backgroundColor:'rgba(255,152,0,0.2)',fill:true,tension:0.3},
    {label:'Lançamento',data:d.receiptsLaunch,borderColor:'#4caf50',backgroundColor:'rgba(76,175,80,0.2)',fill:true,tension:0.3},
    {label:'Mensais',data:d.receiptsMonthly,borderColor:'#2196f3',backgroundColor:'rgba(33,150,243,0.2)',fill:true,tension:0.3},
    {label:'Fluxo Líquido',data:d.net,borderColor:'#c9a84b',backgroundColor:'rgba(201,168,75,0.08)',fill:true,tension:0.3},
    {label:'Investimentos',data:d.investments,borderColor:'#f44336',backgroundColor:'rgba(244,67,54,0.1)',fill:true,tension:0.3},
    {label:'Custos',data:d.costs,borderColor:'#9c27b0',backgroundColor:'rgba(156,39,176,0.1)',fill:true,tension:0.3}
  ];
  const tabDataMap={'Receitas':[datasets[0],datasets[1],datasets[2]],'Custos':[datasets[4],datasets[5]],'Fluxo Líquido':[datasets[3]]};

  ['Receitas','Custos','Fluxo Líquido'].forEach((name,i)=>{
    const tabC=document.createElement('div'); tabC.className='tab-content'; tabC.style.display=i===0?'block':'none';
    const canvas=document.createElement('canvas'); canvas.style.width='100%'; canvas.style.height='300px'; tabC.appendChild(canvas);
    const totals=document.createElement('div'); totals.className='tab-total';
    if(name==='Receitas') totals.innerText='Total: R$ '+d.receiptsPre.concat(d.receiptsLaunch,d.receiptsMonthly).reduce((a,b)=>a+b,0).toLocaleString('pt-BR',{maximumFractionDigits:0});
    if(name==='Custos') totals.innerText='Total: R$ '+d.costs.concat(d.investments).reduce((a,b)=>a+b,0).toLocaleString('pt-BR',{maximumFractionDigits:0});
    if(name==='Fluxo Líquido') totals.innerText='Total: R$ '+d.net.reduce((a,b)=>a+b,0).toLocaleString('pt-BR',{maximumFractionDigits:0});
    tabC.appendChild(totals);
    new Chart(canvas.getContext('2d'),{type:'line',data:{labels,datasets:tabDataMap[name]},options:{responsive:true,plugins:{legend:{labels:{color:'#fff'}}},interaction:{mode:'nearest',axis:'x',intersect:false},scales:{x:{ticks:{color:'#fff'}},y:{ticks:{color:'#fff'}}}}});
    body.appendChild(tabC);
  });
}

function closeModal(){document.getElementById('projectModal').style.display='none';}
</script>

</body>
</html>
