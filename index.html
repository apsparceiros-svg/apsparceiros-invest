<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>APSPARCEIROS Invest — Dashboard Premium (Tela Cheia)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg:#070707;
  --panel:#0f0f0f;
  --muted:#9e9e9e;
  --gold:#c9a84b;
  --card:#121212;
  --accent:#e6e6e6;
}
/* ===== Ajustes gerais ===== */
*{box-sizing:border-box;font-family:Inter,system-ui,Arial;color:var(--accent);margin:0;padding:0}
html,body{
  height:100%;
  width:100%;
  overflow:hidden;
  background:linear-gradient(180deg,#040404,#0a0a0a);
  -webkit-font-smoothing:antialiased;
  font-size:17px;
  transform-origin: top left;
  transform: scale(1.00);
}
/* ===== Cabeçalho ===== */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px 28px;
  border-bottom:1px solid rgba(255,255,255,0.04);
}
.brand{font-weight:800;color:var(--gold);letter-spacing:0.6px;font-size:20px}
.header .meta{color:var(--muted);font-size:14px}
/* ===== Container full screen ===== */
.container{
  display:flex;
  height:calc(100vh - 72px);
  width:100%;
  gap:28px;
  padding:28px;
  overflow:hidden;
}
.sidebar{
  width:22%;
  min-width:300px;
  background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
  border-radius:12px;
  padding:18px;
  overflow-y:auto;
  scrollbar-width:thin;
}
.content{
  flex:1;
  background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));
  border-radius:12px;
  padding:22px;
  overflow-y:auto;
  scrollbar-width:thin;
}
.section-title{font-weight:700;color:var(--gold);margin-bottom:10px}
.small{font-size:13px;color:var(--muted)}
/* ===== Cartões e inputs ===== */
.project-card{
  background:var(--card);
  padding:14px;
  border-radius:10px;
  margin-bottom:14px;
  display:flex;
  gap:12px;
  flex-direction:column;
  border:1px solid rgba(255,255,255,0.03);
  cursor:pointer;
}
.project-card .info{flex:1;width:100%}
.kpi{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
.kpi .item{
  background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));
  padding:10px;
  border-radius:8px;
  min-width:90px;
  text-align:center
}
.kpi .value{font-weight:700;color:var(--gold);margin-top:6px}
.controls label{display:block;font-size:12px;color:var(--muted);margin-top:8px}
.controls input[type=text],
.controls input[type=number],
.project-card input[type=text],
.project-card input[type=number]{
    background-color:#1e1e1e;
    color:#fff;
    border:1px solid #c9a84b;
    padding:8px;
    border-radius:6px;
    width:100%;
    margin-bottom:6px;
}
.project-card input:focus{outline:2px solid #c9a84b;background-color:#292929}
.button{
  background:var(--gold);
  color:#0b0b0b;
  border:none;
  padding:10px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:700;
}
.button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent)}
.card{
  background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));
  padding:14px;
  border-radius:10px;
  margin-bottom:14px;
  border:1px solid rgba(255,255,255,0.03)
}
/* ===== Tooltip ===== */
.tooltip{position:relative;display:inline-block}
.tooltip .tt{
  visibility:hidden;
  width:260px;
  background:#0c0c0c;
  color:var(--muted);
  text-align:left;
  border-radius:6px;
  padding:10px;
  position:absolute;
  z-index:10;
  bottom:130%;
  left:50%;
  transform:translateX(-50%);
  opacity:0;
  transition:opacity .12s;
}
.tooltip:hover .tt{visibility:visible;opacity:1}
/* ===== Gráficos maiores ===== */
#chartPortfolio, #chartFluxo, #chartReceitas, #chartCustos {
  min-height:360px;
}
/* ===== Modal de detalhes ===== */
#detailModal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 200;
}
.modal-inner {
  width: 94%;
  max-width: 1200px;
  max-height: 92vh;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-radius: 14px;
  padding: 20px;
  border:1px solid rgba(255,255,255,0.05);
  overflow:auto;
  position: relative;
}
.modal-close {
  position: absolute;
  right: 16px;
  top: 14px;
  background: transparent;
  border: none;
  color: var(--gold);
  font-size: 22px;
  cursor: pointer;
}
.modal-tabs { display:flex; gap:10px; margin-bottom:14px; }
.tab-btn {
  background:transparent;
  border:1px solid rgba(255,255,255,0.04);
  padding:8px 14px;
  border-radius:8px;
  color:var(--accent);
  cursor:pointer;
}
.tab-btn.active { background:var(--gold); color:#0b0b0b; border-color:var(--gold) }
.stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:10px; margin-top:12px }
.stat { background:var(--card); padding:12px; border-radius:8px; border:1px solid rgba(255,255,255,0.02) }
@media(max-width:1100px){
  html,body{transform:scale(1);overflow:auto}
  .container{flex-direction:column;padding:18px;gap:18px;height:auto}
  .sidebar{width:auto;min-width:unset}
}
</style>
</head>
<body>

<header class="header">
  <div class="brand">APSPARCEIROS Invest</div>
  <div class="meta">Dashboard · Portfólio · Proteção</div>
</header>

<!-- Login Modal -->
<div id="loginModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;align-items:center;justify-content:center;z-index:50">
  <div style="background:#0b0b0b;padding:28px;border-radius:12px;width:420px;border:1px solid rgba(255,255,255,0.05);box-shadow:0 0 15px rgba(201,168,75,0.4);transition:all 0.3s ease" id="loginBox">
    <h2 style="margin-top:0;color:var(--gold);text-align:center">Acesso Premium</h2>
    <p class="small" style="margin-bottom:16px;text-align:center;color:var(--muted)">Digite a senha para desbloquear o painel completo</p>
    <input id="pwd" type="password" placeholder="Senha" style="width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--accent);transition:border 0.2s, box-shadow 0.2s">
    <div style="display:flex;gap:8px;margin-top:18px;justify-content:flex-end">
      <button id="btnLogin" class="button" style="flex:1">Entrar</button>
    </div>
    <p class="small" style="margin-top:12px;color:var(--muted);text-align:center">
      Esqueceu a senha? 
      <a href="https://wa.me/5512997036301?text=Olá!%20Preciso%20de%20ajuda%20para%20acessar%20o%20painel%20APSPARCEIROS%20Invest."
         target="_blank" 
         style="color:var(--gold);text-decoration:none;font-weight:700">
        Entre em contato!
      </a>
    </p>
  </div>
</div>

<div class="container" id="app" style="display:none">
  <aside class="sidebar">
    <div class="section-title">Portfólio</div>
    <div id="projectsList"></div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div><strong>Filtrar</strong><div class="small">por indicador</div></div>
        <div><button id="btnNew" class="button">+ Novo</button></div>
      </div>
      <div class="controls" style="margin-top:10px">
        <label>Busca</label><input id="search" type="text" placeholder="Pesquisar projeto...">
        <label class="small">Mostrar</label>
        <select id="showIndicators"><option value="all">Todos</option><option value="vgv">VGV</option><option value="irr">TIR</option></select>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:10px 0">

        <div><strong>Condições de Venda</strong></div>
        <label>Desconto Pré-lançamento (%)</label>
        <input id="discountPre" type="number" min="0" max="100" step="0.1" value="10">
        <label>Meses Pré-lançamento</label>
        <input id="preLaunchMonths" type="number" min="1" step="1" value="2">

        <label>Desconto Lançamento (%)</label>
        <input id="discountLaunch" type="number" min="0" max="100" step="0.1" value="5">
        <label>Meses Lançamento</label>
        <input id="launchMonths" type="number" min="1" step="1" value="3">

        <label>Pagamento no ato (%)</label>
        <input id="payAtoPct" type="number" min="0" max="100" step="0.1" value="0">

        <label>Entrada (%)</label>
        <input id="entradaPct" type="number" min="0" max="100" step="0.1" value="30">

        <label>Parcelas da entrada (nº)</label>
        <input id="entradaMonths" type="number" min="1" step="1" value="6">

        <label>Pagamento intermediário (%)</label>
        <input id="payInterPct" type="number" min="0" max="100" step="0.1" value="0">

        <label>Mês do pagamento intermediário (após venda)</label>
        <input id="payInterMonth" type="number" min="0" step="1" value="6">

        <label>Parcelas do saldo (nº)</label>
        <input id="parcelasRestantes" type="number" min="1" step="1" value="24">

        <label>Pagamento na entrega das chaves (%)</label>
        <input id="payChavesPct" type="number" min="0" max="100" step="0.1" value="0">

        <label>Correção INCC (mensal, ex.: 0.0045)</label>
        <input id="incc" type="number" min="0" step="0.0001" value="0.0045">
        
        <label>Correção IPCA (mensal, ex.: 0.005)</label>
        <input id="ipca" type="number" min="0" step="0.0001" value="0.005">

        <div class="small" style="margin-top:6px">A entrada é paga em X parcelas a partir do mês da venda; o restante (saldo) é pago em Y parcelas subsequentes. Pagamentos intermediários e pagamento na entrega das chaves são aplicados por unidade vendida.</div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="btnExport" class="button">Exportar JSON</button>
          <button id="btnReset" class="button ghost">Restaurar</button>
        </div>
      </div>
    </div>
    <div class="footer small">APSPARCEIROS Invest · Template editável</div>
  </aside>

  <main class="content">
    <div style="display:flex;gap:12px;align-items:center">
      <div style="flex:1">
        <h2 id="panelTitle">Dashboard</h2>
        <div class="small">Edite os projetos e clique em salvar</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button id="btnDownloadCsv" class="button ghost">Download CSV</button>
        <button id="btnPublish" class="button">Salvar alterações</button>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:12px">
      <section>
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><strong>Visão Geral do Portfólio</strong><div class="small">Resumo consolidado</div></div>
            <div style="text-align:right">
              <div class="small">VGV total</div>
              <div style="font-weight:800;color:var(--gold)" id="totalVgv">R$ 0</div>
            </div>
          </div>
          <div style="display:flex;gap:12px;margin-top:12px">
            <div style="flex:1">
              <div style="height:auto; min-height:120px;">
                <canvas id="chartPortfolio" style="width:100%;height:auto;"></canvas>
              </div>
            </div>
            <div style="width:220px">
              <div class="kpi">
                <div class="item"><div class="small">ROI médio</div><div class="value" id="avgRoi">--</div></div>
                <div class="item"><div class="small">TIR média</div><div class="value" id="avgIrr">--</div></div>
              </div>
              <div style="margin-top:10px" class="small">Clique num projeto no menu lateral para ver detalhes.</div>
            </div>
          </div>
        </div>

        <div id="detailArea" style="display:none"></div>
      </section>

      <aside>
        <div class="card">
          <div class="section-title">Indicadores rápidos</div>
          <table style="width:100%"><tbody>
            <tr><td class="small">VGV</td><td class="small">Valor Geral de Vendas</td></tr>
            <tr><td class="small">ROI</td><td class="small">Retorno sobre o capital</td></tr>
            <tr><td class="small">TIR</td><td class="small">Taxa interna de retorno</td></tr>
            <tr><td class="small">Payback</td><td class="small">Meses para recuperar investimento</td></tr>
          </tbody></table>
        </div>

        <div class="card">
          <div class="section-title">Cap Table (exemplo)</div>
          <div class="small">Incorporador: 50%<br>Terrenista: 20%<br>Investidores: 30%</div>
        </div>
      </aside>
    </div>
  </main>
</div>

<!-- ================= Modal de detalhes ================= -->
<div id="detailModal">
  <div class="modal-inner" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-header" style="display:flex;flex-direction:column;align-items:center;gap:6px">
      <div style="width:100%;display:flex;justify-content:space-between;align-items:center">
        <div>
          <h3 id="modalTitle" style="margin:0;color:var(--gold)"></h3>
          <div class="small" id="modalCity" style="margin-top:4px;color:var(--muted)"></div>
        </div>
        <button class="modal-close" id="closeModal" title="Fechar">✕</button>
      </div>
      <div style="width:100%;display:flex;justify-content:center;align-items:center;gap:6px">
        <div class="small">VGV</div>
        <div style="font-weight:800;color:var(--gold)" id="modalVgv"></div>
      </div>
    </div>

    <div class="modal-tabs" id="modalTabs">
      <button class="tab-btn active" data-tab="fluxo">Fluxo Líquido</button>
      <button class="tab-btn" data-tab="receitas">Receitas</button>
      <button class="tab-btn" data-tab="custos">Custos</button>
    </div>

    <div class="modal-charts">
      <div class="canvas-wrap" id="wrapFluxo" style="display:block">
        <canvas id="chartFluxo" style="width:100%;height:240px;"></canvas>
      </div>
      <div class="canvas-wrap" id="wrapReceitas" style="display:none">
        <canvas id="chartReceitas" style="width:100%;height:240px;"></canvas>
      </div>
      <div class="canvas-wrap" id="wrapCustos" style="display:none">
        <canvas id="chartCustos" style="width:100%;height:240px;"></canvas>
      </div>

      <div class="stats-grid" id="modalStats" style="margin-top:10px"></div>
    </div>
  </div>
</div>

<script>
// ===== Login =====
const password = 'APSPARCEIROS';
const loginModal = document.getElementById('loginModal');
const app = document.getElementById('app');
document.getElementById('btnLogin').onclick = () => {
  const pwd = document.getElementById('pwd').value;
  if(pwd===password){
    loginModal.style.display='none';
    app.style.display='flex';
    initApp();
  }else{
    alert('Senha incorreta!');
  }
}

// ===== App =====
const projects = [
  {id:1,name:"Projeto A",city:"São Paulo",units:12,area:45,preçoM2:12000,totalConstruction:5000000,marketingTotal:120000,brokerTotal:150000}
];
let portfolioChart=null;

function initApp(){
  renderProjects();
  updatePortfolio();
}

function renderProjects(){
  const container=document.getElementById('projectsList');
  container.innerHTML='';
  projects.forEach(p=>{
    const card=document.createElement('div');
    card.className='project-card';
    card.innerHTML=`<div class="info"><strong>${p.name}</strong><div class="small">${p.city}</div></div>`;
    card.onclick=()=>openProjectModal(p.id);
    container.appendChild(card);
  });
}

function computeProject(p){
  const VGV = p.units * p.area * p.preçoM2;
  const roi = ((VGV - p.totalConstruction - p.marketingTotal - p.brokerTotal)/p.totalConstruction)*100;
  const irrAnnual = roi/100/2;
  const npvVal = VGV - (p.totalConstruction+p.marketingTotal+p.brokerTotal);
  const payback = Math.round(p.totalConstruction/(VGV/12));
  const net=Array(12).fill((VGV - p.totalConstruction)/12);
  const receiptsPre = Array(12).fill(VGV*0.2/12);
  const receiptsLaunch = Array(12).fill(VGV*0.3/12);
  const receiptsMonthly = Array(12).fill(VGV*0.5/12);
  const investments = Array(12).fill(p.totalConstruction/12);
  const costs = Array(12).fill((p.marketingTotal+p.brokerTotal)/12);
  const combinedCosts = costs.map((v,i)=>(v||0)+(investments[i]||0));
  return {VGV,roi,irrAnnual,npvVal,payback,net,receiptsPre,receiptsLaunch,receiptsMonthly,investments,costs,combinedCosts,totalConstruction:p.totalConstruction,marketingTotal:p.marketingTotal,brokerTotal:p.brokerTotal};
}

function updatePortfolio(){
  const totalVGV = projects.reduce((sum,p)=>sum+p.units*p.area*p.preçoM2,0);
  document.getElementById('totalVgv').innerText = totalVGV.toLocaleString('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0});
  if(portfolioChart) portfolioChart.destroy();
  portfolioChart = new Chart(document.getElementById('chartPortfolio').getContext('2d'),{
    type:'bar',
    data:{
      labels:projects.map(p=>p.name),
      datasets:[{label:'VGV',data:projects.map(p=>p.units*p.area*p.preçoM2),backgroundColor:'#c9a84b'}]
    },
    options:{responsive:true,plugins:{legend:{display:false}}}
  });
}

// ===== Modal =====
let modalCharts = { fluxo: null, receitas: null, custos: null };
function destroyModalCharts(){
  Object.keys(modalCharts).forEach(k=>{
    if(modalCharts[k]) { try{ modalCharts[k].destroy(); } catch(e){} modalCharts[k] = null; }
  });
}

function openProjectModal(id){
  const p = projects.find(x => x.id === id);
  if (!p) return;
  const d = computeProject(p);

  document.getElementById('modalTitle').innerText = p.name;
  document.getElementById('modalCity').innerText = p.city;
  document.getElementById('modalVgv').innerText = d.VGV.toLocaleString('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0});

  document.getElementById('modalStats').innerHTML = `
    <div class="stat"><div class="small">ROI</div><div style="font-weight:800;color:var(--gold)">${d.roi.toFixed(1)}%</div></div>
    <div class="stat"><div class="small">TIR (a.a.)</div><div style="font-weight:800;color:var(--gold)">${(d.irrAnnual*100).toFixed(1)}%</div></div>
    <div class="stat"><div class="small">VPL (12% a.a.)</div><div style="font-weight:800;color:var(--gold)">${d.npvVal.toLocaleString('pt-BR',{style:'currency',currency:'BRL',maximumFractionDigits:0})}</div></div>
    <div class="stat"><div class="small">Payback</div><div style="font-weight:800;color:var(--gold)">${d.payback} meses</div></div>
  `;

  document.getElementById('detailModal').style.display = 'flex';
  destroyModalCharts();

  function createModalChart(ctx, datasets){
    return new Chart(ctx, {
      type: 'line',
      data: { labels: Array.from({length: d.net.length}, (_, i) => 'M' + (i+1)), datasets: datasets },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode:'nearest', axis:'x', intersect:false },
        scales: { x: { ticks: { color:'#fff' } }, y: { ticks: { color:'#fff' } } },
        plugins: { legend: { labels: { color:'#fff' } } }
      }
    });
  }

  modalCharts.fluxo = createModalChart(document.getElementById('chartFluxo').getContext('2d'), [{ label: 'Fluxo Líquido', data: d.net, borderColor: '#c9a84b', backgroundColor: 'rgba(201,168,75,0.08)', fill: true, tension: 0.3 }]);
  modalCharts.receitas = createModalChart(document.getElementById('chartReceitas').getContext('2d'), [
    { label: 'Pré-lançamento', data: d.receiptsPre, borderColor: '#ff9800', backgroundColor: 'rgba(255,152,0,0.12)', fill: true, tension: 0.3 },
    { label: 'Lançamento', data: d.receiptsLaunch, borderColor: '#4caf50', backgroundColor: 'rgba(76,175,80,0.08)', fill: true, tension: 0.3 },
    { label: 'Mensais', data: d.receiptsMonthly, borderColor: '#2196f3', backgroundColor: 'rgba(33,150,243,0.06)', fill: true, tension: 0.3 }
  ]);
  modalCharts.custos = createModalChart(document.getElementById('chartCustos').getContext('2d'), [
    { label: 'Investimentos', data: d.investments, borderColor: '#9c27b0', backgroundColor: 'rgba(156,39,176,0.06)', fill: true, tension: 0.3 },
    { label: 'Custos operacionais', data: d.costs, borderColor: '#f44336', backgroundColor: 'rgba(244,67,54,0.06)', fill: true, tension: 0.3 },
    { label: 'Total Custos', data: d.combinedCosts, borderColor: '#ff5722', backgroundColor: 'rgba(255,87,34,0.06)', fill: true, tension: 0.3 }
  ]);

  setActiveTab('fluxo');
}

document.getElementById('closeModal').addEventListener('click', ()=> {
  document.getElementById('detailModal').style.display = 'none';
  destroyModalCharts();
});

document.querySelectorAll('#modalTabs .tab-btn').forEach(btn=>{
  btn.addEventListener('click', () => setActiveTab(btn.dataset.tab));
});
function setActiveTab(tab){
  document.querySelectorAll('#modalTabs .tab-btn').forEach(b=> b.classList.toggle('active', b.dataset.tab===tab));
  document.getElementById('wrapFluxo').style.display = (tab==='fluxo') ? 'block' : 'none';
  document.getElementById('wrapReceitas').style.display = (tab==='receitas') ? 'block' : 'none';
  document.getElementById('wrapCustos').style.display = (tab==='custos') ? 'block' : 'none';
  Object.keys(modalCharts).forEach(k=>{ if(modalCharts[k]) try{ modalCharts[k].resize(); modalCharts[k].update(); } catch(e){} });
}
</script>

</body>
</html>
